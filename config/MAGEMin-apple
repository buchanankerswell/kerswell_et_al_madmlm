# Compile MAGEMin on apple with external libraries installed via homebrew
# see https://computationalthermodynamics.github.io/MAGEMin/stp/macOS.html
CC = clang 
EXE_NAME := MAGEMin
CCFLAGS = -Wall -O3 -g -fPIC -Wno-unused-variable -Wno-unused-but-set-variable
LIBS = -lm -framework Accelerate /opt/homebrew/lib/libnlopt.dylib /opt/homebrew/lib/libmpi.dylib
INC = -I/opt/homebrew/include 
EXE_NAME = MAGEMin
SOURCES=src/MAGEMin.c \
		src/toolkit.c \
		src/io_function.c \
		src/gem_function.c \
		src/gss_init_function.c \
		src/gss_function.c \
		src/NLopt_opt_function.c \
		src/objective_functions.c	\
		src/pp_min_function.c \
		src/ss_min_function.c \
		src/simplex_levelling.c \
		src/PGE_function.c \
		src/phase_update_function.c \
		src/dump_function.c
OBJECTS=$(SOURCES:.c=.o)
.c.o:
	$(CC) $(CCFLAGS) -c $< -o $@ $(INC)
all: $(OBJECTS)
	$(CC)  -o $(EXE_NAME) $(OBJECTS) $(INC) $(LIBS) 
	rm src/*.o
lib: $(OBJECTS)
	$(CC) -shared -fPIC  -o libMAGEMin.dylib $(OBJECTS) $(INC) $(LIBS)
clean:
	rm -f src/*.o *.dylib MAGEMin