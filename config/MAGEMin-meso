# Compile MAGEMin on MESO
# Remember to load the following modules:
# module load cv-standard
# module load Nlopt
# module load openblas
# module load openmpi
CC=gcc
EXE_NAME:= MAGEMin
CCFLAGS = -Wall -O3 -g -fPIC -Wno-unused-variable -Wno-unused-result -Wno-unused-function -std=c99
LIBS += -lm /usr/lib64/liblapacke.so.3.4.2 -L/trinity/shared/apps/cv-standard/lapack/3.6.1/lib64 -llapack -lgfortran -L/trinity/shared/apps/cv-standard/openblas/0.2.18/lib -lopenblas -L/trinity/shared/apps/local/Nlopt/2.6.1/lib64 -lnlopt -g -L/usr/lib -L/trinity/shared/apps/cv-standard/openmpi/psm2/gcc49/2.0.1/lib -lmpi
INC += -I/trinity/shared/apps/local/Nlopt/2.6.1/include -I/trinity/shared/apps/cv-standard/openmpi/psm2/gcc49/2.0.1/include -I/trinity/shared/apps/cv-standard/openblas/0.2.18/include
EXE_NAME = MAGEMin
SOURCES=src/MAGEMin.c \
		src/toolkit.c	\
		src/io_function.c	\
		src/gem_function.c \
		src/gss_init_function.c	\
		src/gss_function.c \
		src/NLopt_opt_function.c \
		src/objective_functions.c	\
		src/pp_min_function.c \
		src/ss_min_function.c \
		src/simplex_levelling.c \
		src/PGE_function.c \
		src/phase_update_function.c	\
		src/dump_function.c
OBJECTS=$(SOURCES:.c=.o)
.c.o:
	$(CC) $(CCFLAGS) -c $< -o $@ $(INC)
all: $(OBJECTS)
	$(CC)  -o $(EXE_NAME) $(OBJECTS) $(INC) $(LIBS) 
	rm src/*.o
lib: $(OBJECTS)
	$(CC) -shared -fPIC  -o libMAGEMin.dylib $(OBJECTS) $(INC) $(LIBS)
clean:
	rm -f src/*.o *.dylib MAGEMin
